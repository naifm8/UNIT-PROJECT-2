{% extends 'base.html' %}
{% load static %}
{% with show_create_subprogram=show_create_subprogram sport_slug=sport_slug %}
{% block title %}{{ parent_program.get_sport_type_display }} Programs{% endblock %}

{% block content %}
<style>
  .filter-form .form-control,
  .filter-form .form-select {
    padding: 0.4rem 0.75rem;
    font-size: 0.9rem;
  }

  .create-btn {
    background-color: #000;
    color: #fff;
    border-radius: 50px;
    padding: 6px 18px;
    font-size: 0.9rem;
  }

  .subprogram-card {
    position: relative;
    height: 250px;
    width: 100%;
    border-radius: 10px;
    overflow: hidden;
    background-color: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .subprogram-card .background {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    filter: brightness(60%);
    z-index: 1;
  }

  .subprogram-card .title {
    position: relative;
    z-index: 2;
    font-size: 1.25rem;
    font-weight: bold;
    padding: 0 10px;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .subprogram-card:hover .title {
    transform: scale(1.3);
    opacity: 0.95;
  }

  .home-link {
    margin-top: 30px;
  }
</style>


<div class="container py-3">

  <form method="get" class="row gx-2 gy-2 align-items-center mb-4 filter-form">
    <div class="col-md-3">
      <input type="text" name="q" value="{{ query }}" placeholder="Find programs by title" class="form-control">
    </div>
    <div class="col-md-2">
      <select name="gender" class="form-select">
        <option value="">Gender</option>
        <option value="boys" {% if gender == "boys" %}selected{% endif %}>Boys</option>
        <option value="girls" {% if gender == "girls" %}selected{% endif %}>Girls</option>
        <option value="any" {% if gender == "any" %}selected{% endif %}>Any</option>
      </select>
    </div>
    <div class="col-md-2">
      <select name="age" class="form-select">
        <option value="">Age</option>
        {% for range in age_ranges %}
          <option value="{{ range }}" {% if age == range %}selected{% endif %}>{{ range }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <input type="text" name="coach" value="{{ coach }}" placeholder="Search by coach" class="form-control">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-dark w-100 rounded-pill">Search</button>
    </div>
  </form>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0">{{ parent_program.get_sport_type_display }} SubPrograms</h2>
    {% if user.is_authenticated and user.role in 'admin coach' %}
      <a href="{% url 'academy:subprogram_create' sport_slug %}" class="create-btn text-decoration-none">+ Create SubProgram</a>
    {% endif %}
  </div>

  <div class="row">
    {% for sub in subprograms %}
      <div class="col-md-4 mb-4">
        {% if user.is_authenticated and user.role in 'admin coach' %}
          <a href="{% url 'academy:subprogram_edit' sub.id %}" class="btn btn-outline btn-sm">Edit</a>
          <a href="{% url 'academy:subprogram_delete' sub.id %}" class="btn btn-outline btn-sm">Delete</a>
        {% endif %}
        <a href="{% url 'academy:subprogram_detail' sub.id %}" class="text-decoration-none">
          <div class="subprogram-card">
            <div class="background" style="background-image: url(
              {% if sub.image %}
                '{{ sub.image.url }}'
              {% else %}
                '{% static "images/default-subprogram.webp" %}'
              {% endif %}
            );"></div>
            <div class="title">{{ sub.title }}</div>
          </div>
        </a>
      </div>
    {% empty %}
      <p class="text-center text-muted">No subprograms available for this sport yet.</p>
    {% endfor %}
  </div>

  <div class="home-link">
    <a href="{% url 'academy:home' %}" class="btn btn-outline-secondary rounded-pill">‚Üê Home</a>
  </div>
</div>
{% endblock %}
{% endwith %}